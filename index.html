<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>ARIA-AT Automation</title>
  <meta content="w3c/CG-DRAFT" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="Bikeshed version 26e85e599, updated Thu Dec 8 15:29:31 2022 -0800" name="generator">
  <link href="https://w3c.github.io/aria-at-automation/" rel="canonical">
  <meta content="11f9e3c81a7e917757c2647eb42d30e44f56790b" name="document-revision">
<style>
table { border-collapse: collapse; border-style: hidden hidden none hidden; }
table thead, table tbody { border-bottom: solid; }
table tbody th { text-align: left; }
table tbody th:first-child { border-left: solid; }
table td, table th { border-left: solid; border-right: solid; border-bottom: solid thin; vertical-align: top; padding: 0.2em; }
</style>
<style>
table { border-collapse: collapse; border-style: hidden hidden none hidden; }
table thead, table tbody { border-bottom: solid; }
table tbody th { text-align: left; }
table tbody th:first-child { border-left: solid; }
table td, table th { border-left: solid; border-right: solid; border-bottom: solid thin; vertical-align: top; padding: 0.2em; }
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">ARIA-AT Automation</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2022-12-13">13 December 2022</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/aria-at-automation/">https://w3c.github.io/aria-at-automation/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/w3c/aria-at-automation/issues/">GitHub</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editor:
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:mike@bocoup.com">Mike Pennisi</a> (<a class="p-org org" href="https://bocoup.com">Bocoup</a>)
      <dt class="editor">Former Editor:
      <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:simon@bocoup.com">Simon Pieters</a> (<a class="p-org org" href="https://bocoup.com">Bocoup</a>)
      <dt>Tests:
      <dd><a href="https://github.com/w3c/web-platform-tests/tree/master/aria-at-automation">web-platform-tests aria-at-automation/</a> (<a href="https://github.com/w3c/web-platform-tests/labels/aria-at-automation">ongoing work</a>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>A short description of your spec, one or two sentences. (TODO)</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#explainer"><span class="secno">2</span> <span class="content">Explainer</span></a>
     <ol class="toc">
      <li><a href="#explainer-example"><span class="secno">2.1</span> <span class="content">Example</span></a>
     </ol>
    <li><a href="#infra"><span class="secno">3</span> <span class="content">Infrastructure</span></a>
    <li><a href="#nodes"><span class="secno">4</span> <span class="content">Nodes</span></a>
    <li>
     <a href="#protocol"><span class="secno">5</span> <span class="content">Protocol</span></a>
     <ol class="toc">
      <li><a href="#protocol-definition"><span class="secno">5.1</span> <span class="content">Definition</span></a>
      <li><a href="#protocol-capabilities"><span class="secno">5.2</span> <span class="content">Capabilities</span></a>
      <li><a href="#protocol-session"><span class="secno">5.3</span> <span class="content">Session</span></a>
      <li><a href="#protocol-modules"><span class="secno">5.4</span> <span class="content">Modules</span></a>
      <li><a href="#protocol-commands"><span class="secno">5.5</span> <span class="content">Commands</span></a>
      <li><a href="#protocol-events"><span class="secno">5.6</span> <span class="content">Events</span></a>
      <li><a href="#protocol-errors"><span class="secno">5.7</span> <span class="content">Errors</span></a>
      <li><a href="#security-checks"><span class="secno">5.8</span> <span class="content">Security checks</span></a>
     </ol>
    <li>
     <a href="#transport"><span class="secno">6</span> <span class="content">Transport</span></a>
     <ol class="toc">
      <li><a href="#transport-establishing"><span class="secno">6.1</span> <span class="content">Establishing a Connection</span></a>
     </ol>
    <li>
     <a href="#modules"><span class="secno">7</span> <span class="content">Modules</span></a>
     <ol class="toc">
      <li>
       <a href="#module-session"><span class="secno">7.1</span> <span class="content">The session Module</span></a>
       <ol class="toc">
        <li><a href="#module-session-definition"><span class="secno">7.1.1</span> <span class="content">Definition</span></a>
        <li>
         <a href="#module-session-types"><span class="secno">7.1.2</span> <span class="content">Types</span></a>
         <ol class="toc">
          <li><a href="#module-session-CapabilitiesRequest"><span class="secno">7.1.2.1</span> <span class="content">The session.CapabilitiesRequest Type</span></a>
         </ol>
        <li>
         <a href="#module-session-commands"><span class="secno">7.1.3</span> <span class="content">Commands</span></a>
         <ol class="toc">
          <li><a href="#module-session-new"><span class="secno">7.1.3.1</span> <span class="content">The session.new Command</span></a>
         </ol>
       </ol>
      <li>
       <a href="#module-vendor-settings"><span class="secno">7.2</span> <span class="content">The &lt;vendor>:settings Module</span></a>
       <ol class="toc">
        <li><a href="#module-vendor-settings-definition"><span class="secno">7.2.1</span> <span class="content">Definition</span></a>
        <li>
         <a href="#module-vendor-settings-types"><span class="secno">7.2.2</span> <span class="content">Types</span></a>
         <ol class="toc">
          <li><a href="#module-vendor-settings-get-settings-result"><span class="secno">7.2.2.1</span> <span class="content">The VendorSettingsGetSettingsResult type</span></a>
         </ol>
        <li>
         <a href="#module-settings-commands"><span class="secno">7.2.3</span> <span class="content">Commands</span></a>
         <ol class="toc">
          <li><a href="#command-vendor-settings-set-settings"><span class="secno">7.2.3.1</span> <span class="content">The &lt;vendor>:settings.setSettings Command</span></a>
          <li><a href="#command-vendor-settings-get-settings"><span class="secno">7.2.3.2</span> <span class="content">The &lt;vendor>settings.getSettings Command</span></a>
          <li><a href="#command-vendor-settings-get-supported-settings"><span class="secno">7.2.3.3</span> <span class="content">The &lt;vendor>settings.getSupportedSettings Command</span></a>
          <li><a href="#module-vendor-settings-events"><span class="secno">7.2.3.4</span> <span class="content">Events</span></a>
         </ol>
       </ol>
      <li>
       <a href="#module-interaction"><span class="secno">7.3</span> <span class="content">The Interaction Module</span></a>
       <ol class="toc">
        <li><a href="#module-interaction-definition"><span class="secno">7.3.1</span> <span class="content">Definition</span></a>
        <li><a href="#module-interaction-types"><span class="secno">7.3.2</span> <span class="content">Types</span></a>
        <li>
         <a href="#module-interaction-commands"><span class="secno">7.3.3</span> <span class="content">Commands</span></a>
         <ol class="toc">
          <li><a href="#module-interaction-presskeys"><span class="secno">7.3.3.1</span> <span class="content">The interaction.pressKeys Command</span></a>
         </ol>
        <li><a href="#module-interaction-events"><span class="secno">7.3.4</span> <span class="content">Events</span></a>
       </ol>
     </ol>
    <li><a href="#privacy"><span class="secno">8</span> <span class="content">Privacy</span></a>
    <li><a href="#security"><span class="secno">9</span> <span class="content">Security</span></a>
    <li><a href="#schemas"><span class="secno"></span> <span class="content">Appendix A: Schemas</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>AT Driver defines a protocol for introspection and remote control of assistive technology software, using a bidirectional communication channel.</p>
   <h2 class="heading settled" data-level="2" id="explainer"><span class="secno">2. </span><span class="content">Explainer</span><a class="self-link" href="#explainer"></a></h2>
   <p>Specify a protocol using WebSocket that maximally reuses concepts and conventions from <a href="https://w3c.github.io/webdriver-bidi/">WebDriver BiDi</a>.</p>
   <p>A connection has two endpoints: remote and local. The remote end can control and read from the screen reader, which can either be implemented as a standalone application or be implemented as part of the AT software. The local end is what the test interfaces with, usually in the form of language-specific libraries providing an API.</p>
   <p>There should only be the WebSocket form of communication -- as in <a href="https://w3c.github.io/webdriver-bidi/#supports-bidi-only-sessions">BiDi-only sessions for WebDriver BiDi</a>.</p>
   <p>A connection can have 0 or more <a data-link-type="dfn" href="#session" id="ref-for-session">sessions</a>. Each session corresponds to an instance of an AT. We may limit the maximum number of sessions per AT to 1 initially.</p>
   <p>When a remote end supports multiple sessions, it does not necessarily mean that there will be multiple ATs running at the same time in the same instance of an OS. Some ATs might not be able to function properly if there are other ATs running at the same time. The AT Driver <a data-link-type="dfn" href="#session" id="ref-for-session①">session</a> concept can still be used by having the remote end run in a separate environment and each AT is run in its own OS instance (for example in a virtual machine), and the remote end proxies messages in some fashion.</p>
   <p>Commands are grouped into modules. The modules could be: Sessions, Settings, Actions.</p>
   <p>Message transport is provided using the WebSocket protocol.</p>
   <p>The protocol is defined using a Concise Data Definition Language (CDDL) definition. The serialization is JSON.</p>
   <h3 class="heading settled" data-level="2.1" id="explainer-example"><span class="secno">2.1. </span><span class="content">Example</span><a class="self-link" href="#explainer-example"></a></h3>
   <p>First, the local end would establish a WebSocket connection.</p>
   <p>The local end then creates a session by sending</p>
<pre class="language-json highlight"><c- p>{</c-><c- f>"method"</c-><c- p>:</c-><c- u>"session.new"</c-><c- p>,</c-><c- f>"params"</c-><c- p>:{</c->...<c- p>}}</c->
</pre>
   <p>The local end can then send commands to change settings or send key press actions for that session. The local end assigns a command id (which is included in the message). The remote end sends a message back with the result and the command id, so the local end knows which command the message applies to.</p>
   <p>When the screen reader speaks, the remote end will send a message as to the local end with the spoken text. This could be in the form of an event, which is not tied to any particular command.</p>
   <h2 class="heading settled" data-level="3" id="infra"><span class="secno">3. </span><span class="content">Infrastructure</span><a class="self-link" href="#infra"></a></h2>
   <p>This specification depends on the Infra Standard. <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a></p>
   <p>Network protocol messages are defined using CDDL. <a data-link-type="biblio" href="#biblio-rfc8610" title="Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures">[RFC8610]</a></p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="UUID" data-noexport id="uuid">Universally Unique Identifier (UUID)</dfn> is a 128 bits long URN that requires no central registration process. <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="generating-a-uuid">Generating a UUID</dfn> means <i>Creating a UUID From Truly Random or Pseudo-Random Numbers</i>, and converting it to the string representation. <a data-link-type="biblio" href="#biblio-rfc4122" title="A Universally Unique IDentifier (UUID) URN Namespace">[RFC4122]</a></p>
   <p>Where algorithms that return values are fallible, they are written in terms of returning either <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="success">success</dfn> or <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="error">error</dfn>. A <a data-link-type="dfn" href="#success" id="ref-for-success">success</a> value has an associated data field which encapsulates the value returned, whereas an <a data-link-type="dfn" href="#error" id="ref-for-error">error</a> response has an associated <a data-link-type="dfn" href="#error-code" id="ref-for-error-code">error code</a>.</p>
   <p>When calling a fallible algorithm, the construct "Let <var>result</var> be the result of <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="try|trying" data-noexport id="try">trying</dfn> to call <var>algorithm</var>" is equivalent to:</p>
   <ol>
    <li data-md>
     <p>Let <var>temp</var> be the result of calling <var>algorithm</var>.</p>
    <li data-md>
     <p>If <var>temp</var> is an <a data-link-type="dfn" href="#error" id="ref-for-error①">error</a>, then return <var>temp</var>. Otherwise, let <var>result</var> be <var>temp</var>’s data field.</p>
   </ol>
   <p class="note" role="note"><span>Note:</span> This means that errors are propagated upwards when using "trying".</p>
   <h2 class="heading settled" data-level="4" id="nodes"><span class="secno">4. </span><span class="content">Nodes</span><a class="self-link" href="#nodes"></a></h2>
   <p>The AT Driver protocol consists of communication between:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="local-end">local end</dfn>
    <dd data-md>
     <p>The local end represents the client side of the protocol, which is usually in the form of language-specific libraries providing an API on top of the AT Driver protocol. This specification does not place any restrictions on the details of those libraries above the level of the wire protocol.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-end">remote end</dfn>
    <dd data-md>
     <p>The remote end hosts the server side of the protocol. The remote end is responsible for driving and listening to the assistive technology and sending information to the local end as defined in this specification.</p>
   </dl>
   <h2 class="heading settled" data-level="5" id="protocol"><span class="secno">5. </span><span class="content">Protocol</span><a class="self-link" href="#protocol"></a></h2>
   <p>This section defines the basic concepts of the AT Driver protocol. These terms are distinct from their representation at the transport layer.</p>
   <p>The protocol is defined using a CDDL definition. For the convenience of implementors two separate CDDL definitions are defined; the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-end-definition">remote end definition</dfn> which defines the format of messages produced on the <a data-link-type="dfn" href="#local-end" id="ref-for-local-end">local end</a> and consumed on the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end">remote end</a>, and the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="local-end-definition">local end definition</dfn> which defines the format of messages produced on the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①">remote end</a> and consumed on the <a data-link-type="dfn" href="#local-end" id="ref-for-local-end①">local end</a>.</p>
   <h3 class="heading settled" data-level="5.1" id="protocol-definition"><span class="secno">5.1. </span><span class="content">Definition</span><a class="self-link" href="#protocol-definition"></a></h3>
   <p>This section gives the initial contents of the remote end definition and local end definition. These are augmented by the definition fragments defined in the remainder of the specification.</p>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition">Remote end definition</a></p>
<pre class="cddl remote-cddl">Command = {
  id: uint,
  CommandData,
  *text => any,
}

CommandData = (
  SessionCommand //
  VendorSettingsCommand
)

EmptyParams = { *text => any }
</pre>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition">Local end definition</a>:</p>
<pre class="cddl local-cddl">Message = (
  CommandResponse //
  ErrorResponse //
  Event
)

CommandResponse = {
  id: uint,
  result: ResultData,
  *text => any
}

ErrorResponse = {
  id: uint / null,
  error: "unknown error" / "unknown command" / "invalid argument" / "session not created",
  message: text,
  ?stacktrace: text,
  *text => any
}

ResultData = (
  EmptyResult //
  SessionResult //
  VendorSettingsResult
)

EmptyResult = {}

Event = {
  EventData,
  *text => any
}

EventData = (
  InteractionEvent
)
</pre>
   <h3 class="heading settled" data-level="5.2" id="protocol-capabilities"><span class="secno">5.2. </span><span class="content">Capabilities</span><a class="self-link" href="#protocol-capabilities"></a></h3>
   <p><dfn data-dfn-type="dfn" data-noexport id="capabilities">Capabilities<a class="self-link" href="#capabilities"></a></dfn> are used to communicate the features supported by a given implementation. The <a data-link-type="dfn" href="#local-end" id="ref-for-local-end②">local end</a> may use capabilities to define which features it requires the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end②">remote end</a> to satisfy when creating a new <a data-link-type="dfn" href="#session" id="ref-for-session②">session</a>. Likewise, the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end③">remote end</a> uses capabilities to describe the full feature set for a <a data-link-type="dfn" href="#session" id="ref-for-session③">session</a>.</p>
   <p>The following table of <dfn data-dfn-type="dfn" data-noexport id="standard-capabilities">standard capabilities<a class="self-link" href="#standard-capabilities"></a></dfn> enumerates the capabilities each implementation must support.</p>
   <table>
    <caption>Standard capabilities</caption>
    <tbody>
     <tr>
      <th>Capability 
      <th>Key 
      <th>Value type 
      <th>Description 
     <tr>
      <td><dfn data-dfn-for="standard capabilities" data-dfn-type="dfn" data-noexport id="standard-capabilities-at-name">AT name<a class="self-link" href="#standard-capabilities-at-name"></a></dfn> 
      <td>"<code>atName</code>" 
      <td><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a> 
      <td>Identifies the assistive technology. 
     <tr>
      <td><dfn data-dfn-for="standard capabilities" data-dfn-type="dfn" data-noexport id="standard-capabilities-at-version">AT version<a class="self-link" href="#standard-capabilities-at-version"></a></dfn> 
      <td>"<code>atVersion</code>" 
      <td><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">string</a> 
      <td>Identifies the version of the assistive technology. 
     <tr>
      <td><dfn data-dfn-for="standard capabilities" data-dfn-type="dfn" data-noexport id="standard-capabilities-platform">Platform<a class="self-link" href="#standard-capabilities-platform"></a></dfn> 
      <td>"<code>platformName</code>" 
      <td><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">string</a> 
      <td>Identifies the operating system of the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end④">remote end</a>. 
   </table>
   <p><a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end⑤">Remote ends</a> may introduce <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="extension-capabilities">extension capabilities</dfn> that are extra capabilities used to provide configuration or fulfill other vendor-specific needs. Extension capabilities' key must contain a "<code>:</code>" (colon) character, denoting an implementation specific namespace. The value can be arbitrary JSON types.</p>
   <div class="algorithm" data-algorithm="process capabilities">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="process-capabilities">process capabilities</dfn> with argument <var>parameters</var>, the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end⑥">remote end</a> must:</p>
    <ol>
     <li data-md>
      <p>Let <var>capabilities request</var> be <var>parameters</var>["<code>capabilities</code>"] if it <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a>, else null.</p>
     <li data-md>
      <p>Let <var>required capabilities</var> be <var>capabilities request</var>["<code>alwaysMatch</code>"] if it <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>, else null.</p>
     <li data-md>
      <p>Let <var>matched capabilities</var> be the result of <a data-link-type="dfn" href="#try" id="ref-for-try">trying</a> to <a data-link-type="dfn" href="#match-capabilities" id="ref-for-match-capabilities">match capabilities</a> given <var>required capabilities</var>.</p>
     <li data-md>
      <p>If <var>matched capabilities</var> is not null, then return <a data-link-type="dfn" href="#success" id="ref-for-success①">success</a> with data <var>matched capabilities</var>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="#success" id="ref-for-success②">success</a> with data null.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="match capabilities">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="match-capabilities">match capabilities</dfn> given <var>requested capabilities</var>, the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end⑦">remote end</a> must:</p>
    <ol>
     <li data-md>
      <p>Let <var>matched capabilities</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">map</a> with the following entries:</p>
      <dl>
       <dt data-md>"<code>atName</code>"
       <dd data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-lowercase" id="ref-for-ascii-lowercase">ASCII lowercase</a> name of the assistive technology as a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③">string</a>.</p>
       <dt data-md>"<code>atVersion</code>"
       <dd data-md>
        <p>The assistive technology version, as a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string④">string</a>.</p>
       <dt data-md>"<code>platformName</code>"
       <dd data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ascii-lowercase" id="ref-for-ascii-lowercase①">ASCII lowercase</a> name of the current platform as a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑤">string</a>.</p>
      </dl>
     <li data-md>
      <p>Optionally add <a data-link-type="dfn" href="#extension-capabilities" id="ref-for-extension-capabilities">extension capabilities</a> as entries to <var>matched capabilities</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-iterate" id="ref-for-map-iterate">For each</a> <var>key</var> → <var>value</var> of <var>requested capabilities</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>match value</var> be <var>value</var>.</p>
       <li data-md>
        <p>Switch on <var>key</var>:</p>
        <dl>
         <dt data-md>"<code>atName</code>"
         <dd data-md>
          <p>If <var>value</var> is not equal to <var>matched capabilities</var>["<code>atName</code>"], then return <a data-link-type="dfn" href="#success" id="ref-for-success③">success</a> with data null.</p>
         <dt data-md>"<code>atVersion</code>"
         <dd data-md>
          <p>Compare <var>value</var> to <var>matched capabilities</var>["<code>browserVersion</code>"] using an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> comparison algorithm. The comparison is to accept a value that places constraints on the version using the "<code>&lt;</code>", "<code>&lt;=</code>", "<code>></code>", and "<code>>=</code>" operators.</p>
         <dt data-md>"<code>platformName</code>"
         <dd data-md>
          <p>If <var>value</var> is not equal to <var>matched capabilities</var>["<code>platformName</code>"], then return <a data-link-type="dfn" href="#success" id="ref-for-success④">success</a> with data null.</p>
         <dt data-md>Otherwise
         <dd data-md>
          <p>If <var>key</var> is the key of an <a data-link-type="dfn" href="#extension-capabilities" id="ref-for-extension-capabilities①">extension capability</a>, set <var>match value</var> to the result of <a data-link-type="dfn" href="#try" id="ref-for-try①">trying</a> implementation-specific steps to match on <var>key</var> with <var>value</var>. If the match is not successful, return <a data-link-type="dfn" href="#success" id="ref-for-success⑤">success</a> with data null.</p>
        </dl>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-set" id="ref-for-map-set">Set</a> <var>matched capabilities</var>[<var>key</var>] to <var>match value</var>.</p>
      </ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="#success" id="ref-for-success⑥">success</a> with data <var>matched capabilities</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="5.3" id="protocol-session"><span class="secno">5.3. </span><span class="content">Session</span><a class="self-link" href="#protocol-session"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="session">session</dfn> represents the connection between a <a data-link-type="dfn" href="#local-end" id="ref-for-local-end③">local end</a> and a specific <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end⑧">remote end</a>.</p>
   <p>A <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end⑨">remote end</a> has an associated list of <dfn class="dfn-paneled" data-dfn-for="remote end" data-dfn-type="dfn" data-noexport id="remote-end-active-sessions">active sessions</dfn>, which is a list of all <a data-link-type="dfn" href="#session" id="ref-for-session④">sessions</a> that are currently started. A remote end has at most one <a data-link-type="dfn" href="#remote-end-active-sessions" id="ref-for-remote-end-active-sessions">active session</a> at a given time.</p>
   <p>A <a data-link-type="dfn" href="#session" id="ref-for-session⑤">session</a> has an associated <dfn class="dfn-paneled" data-dfn-for="session" data-dfn-type="dfn" data-noexport id="session-session-id">session ID</dfn> (a string representation of a <a data-link-type="dfn" href="#uuid" id="ref-for-uuid">UUID</a>) used to uniquely identify this session. Unless stated otherwise it is null.</p>
   <h3 class="heading settled" data-level="5.4" id="protocol-modules"><span class="secno">5.4. </span><span class="content">Modules</span><a class="self-link" href="#protocol-modules"></a></h3>
   <p>The AT Driver protocol is organized into modules.</p>
   <p>Each <dfn data-dfn-type="dfn" data-noexport id="module">module<a class="self-link" href="#module"></a></dfn> represents a collection of related <a data-link-type="dfn" href="#command" id="ref-for-command">commands</a> and <a data-link-type="dfn" href="#event" id="ref-for-event">events</a> pertaining to a certain aspect of the assistive technology.</p>
   <p>Each module has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="module-name">module name</dfn> which is a string. The <a data-link-type="dfn" href="#command-name" id="ref-for-command-name">command name</a> and <a data-link-type="dfn" href="#event-name" id="ref-for-event-name">event name</a> for commands and events defined in the module start with the <a data-link-type="dfn" href="#module-name" id="ref-for-module-name">module name</a> followed by a period "<code>.</code>".</p>
   <p>Modules which contain <a data-link-type="dfn" href="#command" id="ref-for-command①">commands</a> define <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition①">remote end definition</a> fragments.</p>
   <p>An implementation may define <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="extension-modules">extension modules</dfn>. These must have a module name that contains a single colon "<code>:</code>" character. The part before the colon is the prefix; this is typically the same for all extension modules specific to a given implementation and should be unique for a given implementation. Such modules extend the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①">local end definition</a> and <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition②">remote end definition</a> providing additional groups as choices for the defined <a data-link-type="dfn" href="#command" id="ref-for-command②">commands</a> and <a data-link-type="dfn" href="#event" id="ref-for-event①">events</a>.</p>
   <h3 class="heading settled" data-level="5.5" id="protocol-commands"><span class="secno">5.5. </span><span class="content">Commands</span><a class="self-link" href="#protocol-commands"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="command">command</dfn> is an asynchronous operation, requested by the <a data-link-type="dfn" href="#local-end" id="ref-for-local-end④">local end</a> and run on the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①⓪">remote end</a>, resulting in either a <a data-link-type="dfn" href="#success" id="ref-for-success⑦">success</a> or an <a data-link-type="dfn" href="#error" id="ref-for-error②">error</a> being returned to the <a data-link-type="dfn" href="#local-end" id="ref-for-local-end⑤">local end</a>. Multiple commands can run at the same time, and commands can potentially be long-running. As a consequence, commands can finish out-of-order.</p>
   <p>Each <a data-link-type="dfn" href="#command" id="ref-for-command③">command</a> is defined by:</p>
   <ul>
    <li data-md>
     <p>A <dfn data-dfn-type="dfn" data-noexport id="command-type">command type<a class="self-link" href="#command-type"></a></dfn> which is defined by a <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition③">remote end definition</a> fragment containing a group. Each such group has two fields:</p>
     <ul>
      <li data-md>
       <p><code>method</code> which is a string literal in the form <code>[module name].[method name]</code>. This is the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="command-name">command name</dfn>.</p>
      <li data-md>
       <p><code>params</code> which defines a mapping containing data that to be passed into the command. The populated value of this map is the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="command-parameters">command parameters</dfn>.</p>
     </ul>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="result-type">result type</dfn>, which is defined by the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition②">local end definition</a> fragment.</p>
    <li data-md>
     <p>A set of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-end-steps">remote end steps</dfn> which define the actions to take for a command given a <a data-link-type="dfn" href="#session" id="ref-for-session⑥">session</a> and <a data-link-type="dfn" href="#command-parameters" id="ref-for-command-parameters">command parameters</a> and return an instance of the command <a data-link-type="dfn" href="#result-type" id="ref-for-result-type">result type</a>.</p>
   </ul>
   <p>A command that can run without an active session is a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="static-command">static command</dfn>. Commands are not static commands unless stated in their definition.</p>
   <p>When commands are sent from the <a data-link-type="dfn" href="#local-end" id="ref-for-local-end⑥">local end</a> they have a command id. This is an identifier used by the <a data-link-type="dfn" href="#local-end" id="ref-for-local-end⑦">local end</a> to identify the response from a particular command. From the point of view of the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①①">remote end</a> this identifier is opaque and cannot be used internally to identify the command.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-of-all-command-names">set of all command names</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">set</a> containing all the defined <a data-link-type="dfn" href="#command-name" id="ref-for-command-name①">command names</a>, including any belonging to <a data-link-type="dfn" href="#extension-modules" id="ref-for-extension-modules">extension modules</a>.</p>
   <h3 class="heading settled" data-level="5.6" id="protocol-events"><span class="secno">5.6. </span><span class="content">Events</span><a class="self-link" href="#protocol-events"></a></h3>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="event">event</dfn> is a notification, sent by the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①②">remote end</a> to the <a data-link-type="dfn" href="#local-end" id="ref-for-local-end⑧">local end</a>, signaling that something of interest has occurred on the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①③">remote end</a>.</p>
   <ul>
    <li data-md>
     <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="event-type">event type</dfn> is defined by a <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition③">local end definition</a> fragment containing a group. Each such group has two fields:</p>
     <ul>
      <li data-md>
       <p><code>method</code> which is a string literal of the form <code>[module name].[event name]</code>. This is the <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="event-name">event name</dfn>.</p>
      <li data-md>
       <p><code>params</code> which defines a mapping containing event data. The populated value of this map is the <dfn data-dfn-type="dfn" data-noexport id="event-parameters">event parameters<a class="self-link" href="#event-parameters"></a></dfn>.</p>
     </ul>
    <li data-md>
     <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="remote-end-event-trigger">remote end event trigger</dfn> which defines when the event is triggered and steps to construct the <a data-link-type="dfn" href="#event-type" id="ref-for-event-type">event type</a> data.</p>
   </ul>
   <h3 class="heading settled" data-level="5.7" id="protocol-errors"><span class="secno">5.7. </span><span class="content">Errors</span><a class="self-link" href="#protocol-errors"></a></h3>
   <p>The following table lists each <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="error-code">error code</dfn>, its associated JSON <code>error</code> code, and a non-normative description of the error.</p>
   <table>
    <caption>Error codes</caption>
    <tbody>
     <tr>
      <th>Error code 
      <th>JSON error code 
      <th>Description 
     <tr>
      <td><dfn data-dfn-for="error code" data-dfn-type="dfn" data-noexport id="error-code-invalid-argument">invalid argument<a class="self-link" href="#error-code-invalid-argument"></a></dfn> 
      <td><code>invalid argument</code> 
      <td>The arguments passed to a <a data-link-type="dfn" href="#command" id="ref-for-command④">command</a> are either invalid or malformed. 
     <tr>
      <td><dfn class="dfn-paneled" data-dfn-for="error code" data-dfn-type="dfn" data-noexport id="error-code-invalid-session-id">invalid session id</dfn> 
      <td><code>invalid session id</code> 
      <td>The <a data-link-type="dfn" href="#session" id="ref-for-session⑦">session</a> either does not exist or it’s not active. 
     <tr>
      <td><dfn class="dfn-paneled" data-dfn-for="error code" data-dfn-type="dfn" data-noexport id="error-code-unknown-command">unknown command</dfn> 
      <td><code>unknown command</code> 
      <td>A <a data-link-type="dfn" href="#command" id="ref-for-command⑤">command</a> could not be executed because the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①④">remote end</a> is not aware of it. 
     <tr>
      <td><dfn class="dfn-paneled" data-dfn-for="error code" data-dfn-type="dfn" data-noexport id="error-code-session-not-created">session not created</dfn> 
      <td><code>session not created</code> 
      <td>A new <a data-link-type="dfn" href="#session" id="ref-for-session⑧">session</a> could not be created. 
     <tr>
      <td><dfn class="dfn-paneled" data-dfn-for="error code" data-dfn-type="dfn" data-noexport id="error-code-invalid-os-focus-state">invalid OS focus state</dfn> 
      <td><code>invalid OS focus state</code> 
      <td>The application that currently has OS focus is not one of the expected applications. 
   </table>
   <h3 class="heading settled" data-level="5.8" id="security-checks"><span class="secno">5.8. </span><span class="content">Security checks</span><a class="self-link" href="#security-checks"></a></h3>
   <p>In order to mitigate security risks when using this API, there are some security checks for certain commands.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="check-that-one-of-the-expected-applications-has-focus">check that one of the expected applications has focus</dfn>:</p>
   <ol>
    <li data-md>
     <p>If the application that currently has OS focus (and so could act on simulated key presses from this API) is not one of the expected applications, then return an <a data-link-type="dfn" href="#error" id="ref-for-error③">error</a> with <a data-link-type="dfn" href="#error-code" id="ref-for-error-code①">error code</a> <a data-link-type="dfn" href="#error-code-invalid-os-focus-state" id="ref-for-error-code-invalid-os-focus-state">invalid OS focus state</a>. Which applications are expected is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①">implementation-defined</a>.</p>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="#success" id="ref-for-success⑧">success</a> with data null.</p>
   </ol>
   <h2 class="heading settled" data-level="6" id="transport"><span class="secno">6. </span><span class="content">Transport</span><a class="self-link" href="#transport"></a></h2>
   <p>Message transport is provided using the WebSocket protocol. <a data-link-type="biblio" href="#biblio-rfc6455" title="The WebSocket Protocol">[RFC6455]</a></p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="websocket-listener">WebSocket listener</dfn> is a network endpoint that is able to accept incoming WebSocket connections.</p>
   <p>A <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener">WebSocket listener</a> has a <dfn class="dfn-paneled" data-dfn-for="WebSocket listener" data-dfn-type="dfn" data-noexport id="websocket-listener-host">host</dfn>,
a <dfn class="dfn-paneled" data-dfn-for="WebSocket listener" data-dfn-type="dfn" data-noexport id="websocket-listener-port">port</dfn>,
and a <dfn class="dfn-paneled" data-dfn-for="WebSocket listener" data-dfn-type="dfn" data-noexport id="websocket-listener-secure-flag">secure flag</dfn>.</p>
   <p>When a <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener①">WebSocket listener</a> <var>listener</var> is created, a <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①⑤">remote end</a> must start to listen for WebSocket connections on the host and port given by <var>listener</var>’s host and port. If <var>listener</var>’s <a data-link-type="dfn" href="#websocket-listener-secure-flag" id="ref-for-websocket-listener-secure-flag">secure flag</a> is set, then connections established from <var>listener</var> must be TLS encrypted.</p>
   <p>A <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①⑥">remote end</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set①">set</a> of <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener②">WebSocket listeners</a> <dfn class="dfn-paneled" data-dfn-for="remote end" data-dfn-type="dfn" data-noexport id="remote-end-active-listeners">active listeners</dfn>, which is initially empty.</p>
   <p>A <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①⑦">remote end</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set②">set</a> of <dfn class="dfn-paneled" data-dfn-for="remote end" data-dfn-type="dfn" data-noexport id="remote-end-websocket-connections-not-associated-with-a-session">WebSocket connections not associated with a session</dfn>, which is initially empty.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="websocket-connection">WebSocket connection</dfn> is a network connection that follows the requirements of the WebSocket protocol. <a data-link-type="biblio" href="#biblio-rfc6455" title="The WebSocket Protocol">[RFC6455]</a></p>
   <p>A <a data-link-type="dfn" href="#session" id="ref-for-session⑨">session</a> has a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set③">set</a> of <dfn class="dfn-paneled" data-dfn-for="session" data-dfn-type="dfn" data-noexport id="session-session-websocket-connections">session WebSocket connections</dfn> whose elements are <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection">WebSocket connections</a>. This is initially empty.</p>
   <p>A <a data-link-type="dfn" href="#session" id="ref-for-session①⓪">session</a> <var>session</var> is <dfn class="dfn-paneled" data-dfn-for="session" data-dfn-type="dfn" data-noexport id="session-associated-with-connection">associated with connection</dfn> <var>connection</var> if <var>session</var>’s <a data-link-type="dfn" href="#session-session-websocket-connections" id="ref-for-session-session-websocket-connections">session WebSocket connections</a> contains <var>connection</var>.</p>
   <p class="note" role="note"><span>Note:</span> Each <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection①">WebSocket connection</a> is associated with at most one <a data-link-type="dfn" href="#session" id="ref-for-session①①">session</a>.</p>
   <p>When a client <a href="https://tools.ietf.org/html/rfc6455#section-4.1">establishes a WebSocket connection</a> <var>connection</var> by connecting to one of the set of <a data-link-type="dfn" href="#remote-end-active-listeners" id="ref-for-remote-end-active-listeners">active listeners</a> <var>listener</var>, the implementation must proceed according to the <a href="https://tools.ietf.org/html/rfc6455#section-4.2">WebSocket server-side requirements</a>, with the following steps run when deciding whether to accept the incoming connection:</p>
   <ol>
    <li data-md>
     <p>Let <var>resource name</var> be the resource name from <a href="https://tools.ietf.org/html/rfc6455#section-4.2.1">reading the client’s opening handshake</a>. If <var>resource name</var> is not "<code>/session</code>", then stop running these steps and act as if the requested service is not available.</p>
    <li data-md>
     <p>Run any other <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined②">implementation-defined</a> steps to decide if the connection should be accepted, and if it is not stop running these steps and act as if the requested service is not available.</p>
    <li data-md>
     <p>Add the connection to the set of <a data-link-type="dfn" href="#remote-end-websocket-connections-not-associated-with-a-session" id="ref-for-remote-end-websocket-connections-not-associated-with-a-session">WebSocket connections not associated with a session</a>.</p>
   </ol>
   <p>When a <a href="https://tools.ietf.org/html/rfc6455#section-6.2">WebSocket message has been received</a> for a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection②">WebSocket connection</a> <var>connection</var> with type <var>type</var> and data <var>data</var>, a <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①⑧">remote end</a> must <a data-link-type="dfn" href="#handle-an-incoming-message" id="ref-for-handle-an-incoming-message">handle an incoming message</a> given <var>connection</var>, <var>type</var> and <var>data</var>.</p>
   <p>When the <a href="https://tools.ietf.org/html/rfc6455#section-7.1.3">WebSocket closing handshake is started</a> or when the <a href="https://tools.ietf.org/html/rfc6455#section-7.1.4">WebSocket connection is closed</a> for a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection③">WebSocket connection</a> <var>connection</var>, a <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end①⑨">remote end</a> must <a data-link-type="dfn" href="#handle-a-connection-closing" id="ref-for-handle-a-connection-closing">handle a connection closing</a> given <var>connection</var>.</p>
   <p class="note" role="note"><span>Note:</span> Both conditions are needed because it is possible for a WebSocket connection to be closed without a closing handshake.</p>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="start-listening-for-a-websocket-connection">start listening for a WebSocket connection</dfn>:</p>
   <ol>
    <li data-md>
     <p>Let <var>listener</var> be a new <a data-link-type="dfn" href="#websocket-listener" id="ref-for-websocket-listener③">WebSocket listener</a> with <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined③">implementation-defined</a> <a data-link-type="dfn" href="#websocket-listener-host" id="ref-for-websocket-listener-host">host</a>, <a data-link-type="dfn" href="#websocket-listener-port" id="ref-for-websocket-listener-port">port</a>, and <a data-link-type="dfn" href="#websocket-listener-secure-flag" id="ref-for-websocket-listener-secure-flag①">secure flag</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#set-append" id="ref-for-set-append">Append</a> <var>listener</var> to the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end②⓪">remote end</a>'s <a data-link-type="dfn" href="#remote-end-active-listeners" id="ref-for-remote-end-active-listeners①">active listeners</a>.</p>
    <li data-md>
     <p>Return <var>listener</var>.</p>
   </ol>
   <p class="note" role="note"><span>Note:</span> a future iteration of this specification may allow multiple connections, to support <a href="https://w3c.github.io/webdriver/#dfn-intermediary-nodes">intermediary nodes like in WebDriver</a>.</p>
   <div class="algorithm" data-algorithm="handle an incoming message">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-an-incoming-message">handle an incoming message</dfn> given a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection④">WebSocket connection</a> <var>connection</var>, type <var>type</var> and data <var>data</var>:</p>
    <ol>
     <li data-md>
      <p>If <var>type</var> is not <a href="https://tools.ietf.org/html/rfc6455#section-5.2">text</a>, <a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error">respond with an error</a> given <var>connection</var>, null, and <a data-link-type="dfn">invalid argument</a>, and finally return.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert">Assert</a>: <var>data</var> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#scalar-value-string" id="ref-for-scalar-value-string">scalar value string</a>, because the <a href="https://tools.ietf.org/html/rfc6455#section-8.1">WebSocket handling errors in UTF-8-encoded data=</a> would already have <a href="https://tools.ietf.org/html/rfc6455#section-7.1.7">failed the WebSocket connection</a> otherwise.</p>
     <li data-md>
      <p>If there is a <a data-link-type="dfn" href="#session" id="ref-for-session①②">session</a> <a data-link-type="dfn" href="#session-associated-with-connection" id="ref-for-session-associated-with-connection">associated with connection</a> <var>connection</var>, let <var>session</var> be that session. Otherwise if <var>connection</var> is in the set of <a data-link-type="dfn" href="#remote-end-websocket-connections-not-associated-with-a-session" id="ref-for-remote-end-websocket-connections-not-associated-with-a-session①">WebSocket connections not associated with a session</a>, let <var>session</var> be null. Otherwise, return.</p>
     <li data-md>
      <p>Let <var>parsed</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value" id="ref-for-parse-a-json-string-to-an-infra-value">parsing JSON into Infra values</a> given <var>data</var>. If this throws an exception, then <a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error①">respond with an error</a> given <var>connection</var>, null, and <a data-link-type="dfn">invalid argument</a>, and finally return.</p>
     <li data-md>
      <p>Match parsed against the <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition④">remote end definition</a>. If this results in a match:</p>
      <ol>
       <li data-md>
        <p>Let <var>matched</var> be the map representing the matched data.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert①">Assert</a>: <var>matched</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists②">contains</a> "<code>id</code>", "<code>method</code>", and "<code>params</code>".</p>
       <li data-md>
        <p>Let <var>command id</var> be <var>matched</var>["<code>id</code>"].</p>
       <li data-md>
        <p>Let <var>method</var> be <var>matched</var>["<code>method</code>"].</p>
       <li data-md>
        <p>Let <var>command</var> be the command with <a data-link-type="dfn" href="#command-name" id="ref-for-command-name②">command name</a> <var>method</var>.</p>
       <li data-md>
        <p>If <var>session</var> is null and <var>command</var> is not a <a data-link-type="dfn" href="#static-command" id="ref-for-static-command">static command</a>, then <a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error②">respond with an error</a> given <var>connection</var>, <var>command id</var>, and <a data-link-type="dfn" href="#error-code-invalid-session-id" id="ref-for-error-code-invalid-session-id">invalid session id</a>, and return.</p>
       <li data-md>
        <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>result</var> be the result of running the <a data-link-type="dfn" href="#remote-end-steps" id="ref-for-remote-end-steps">remote end steps</a> for <var>command</var> given <var>session</var> and <a data-link-type="dfn" href="#command-parameters" id="ref-for-command-parameters①">command parameters</a> <var>matched</var>["<code>params</code>"].</p>
         <li data-md>
          <p>If <var>result</var> is an <a data-link-type="dfn" href="#error" id="ref-for-error④">error</a>, then <a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error③">respond with an error</a> given <var>connection</var>, <var>command id</var>, and <var>result</var>’s <a data-link-type="dfn" href="#error-code" id="ref-for-error-code②">error code</a>, and finally return.</p>
         <li data-md>
          <p>Let <var>value</var> be <var>result</var>’s data.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert②">Assert</a>: <var>value</var> matches the definition for the <a data-link-type="dfn" href="#result-type" id="ref-for-result-type①">result type</a> corresponding to the command with <a data-link-type="dfn" href="#command-name" id="ref-for-command-name③">command name</a> <var>method</var>.</p>
         <li data-md>
          <p>If <var>method</var> is "<code>session.new</code>", let <a data-link-type="dfn" href="#session" id="ref-for-session①③">session</a> be the entry in the list of <a data-link-type="dfn" href="#remote-end-active-sessions" id="ref-for-remote-end-active-sessions①">active sessions</a> whose <a data-link-type="dfn" href="#session-session-id" id="ref-for-session-session-id">session ID</a> is equal to the "<code>sessionId</code>" property of <var>value</var>, let <var>session</var>’s <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection⑤">WebSocket connection</a> be <var>connection</var>, and remove <var>connection</var> from the set of <a data-link-type="dfn" href="#remote-end-websocket-connections-not-associated-with-a-session" id="ref-for-remote-end-websocket-connections-not-associated-with-a-session②">WebSocket connections not associated with a session</a>.</p>
         <li data-md>
          <p>Let <var>response</var> be a new map matching the <code>CommandResponse</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition④">local end definition</a> with the <code>id</code> field set to <var>command id</var> and the <code>value</code> field set to <var>value</var>.</p>
         <li data-md>
          <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes" id="ref-for-serialize-an-infra-value-to-json-bytes">serialize an infra value to JSON bytes</a> given <var>response</var>.</p>
         <li data-md>
          <p><a href="https://tools.ietf.org/html/rfc6455#section-6.1">Send a WebSocket message</a> comprised of <var>serialized</var> over <var>connection</var>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Otherwise:</p>
      <ol>
       <li data-md>
        <p>Let <var>command id</var> be null.</p>
       <li data-md>
        <p>If <var>parsed</var> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">map</a> and <var>parsed</var>["<code>id</code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists③">exists</a> and is an integer greater than or equal to zero, set <var>command id</var> to that integer.</p>
       <li data-md>
        <p>Let <var>error code</var> be <a data-link-type="dfn">invalid argument</a>.</p>
       <li data-md>
        <p>If <var>parsed</var> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map②">map</a> and <var>parsed</var>["<code>method</code>"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists④">exists</a> and is a string, but <var>parsed</var>["<code>method</code>"] is not in the <a data-link-type="dfn" href="#set-of-all-command-names" id="ref-for-set-of-all-command-names">set of all command names</a>, set <var>error code</var> to <a data-link-type="dfn" href="#error-code-unknown-command" id="ref-for-error-code-unknown-command">unknown command</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="#respond-with-an-error" id="ref-for-respond-with-an-error④">Respond with an error</a> given <var>connection</var>, <var>command id</var>, and <var>error code</var>.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="emit an event">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="emit-an-event">emit an event</dfn> given <var>session</var>, and <var>body</var>:</p>
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#assert" id="ref-for-assert③">Assert</a>: <var>body</var> has <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-size" id="ref-for-map-size">size</a> 2 and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists⑤">contains</a> "<code>method</code>" and "<code>params</code>".</p>
     <li data-md>
      <p>Let <var>connection</var> be <var>session</var>’s <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection⑥">WebSocket connection</a>.</p>
     <li data-md>
      <p>If <var>connection</var> is null, return.</p>
     <li data-md>
      <p>Let <var>serialized</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes" id="ref-for-serialize-an-infra-value-to-json-bytes①">serialize an infra value to JSON bytes</a> given <var>body</var>.</p>
     <li data-md>
      <p><a href="https://tools.ietf.org/html/rfc6455#section-6.1">Send a WebSocket message</a> comprised of <var>serialized</var> over <var>connection</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="respond with an error">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="respond-with-an-error">respond with an error</dfn> given a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection⑦">WebSocket connection</a> <var>connection</var>, <var>command id</var>, and <var>error code</var>:</p>
    <ol>
     <li data-md>
      <p>Let <var>error data</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map③">map</a> matching the <code>ErrorResponse</code> production in the <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑤">local end definition</a>, with the <code>id</code> field set to <var>command id</var>, the <code>error</code> field set to <var>error code</var>, the <code>message</code> field set to an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined④">implementation-defined</a> string containing a human-readable definition of the error that occurred and the <code>stacktrace</code> field optionally set to an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑤">implementation-defined</a> string containing a stack trace report of the active stack frames at the time when the error occurred.</p>
     <li data-md>
      <p>Let <var>response</var> be the result of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes" id="ref-for-serialize-an-infra-value-to-json-bytes②">serialize an infra value to JSON bytes</a> given <var>error data</var>.
  Note: command id can be null, in which case the id field will also be set to null, not omitted from response.</p>
     <li data-md>
      <p><a href="https://tools.ietf.org/html/rfc6455#section-6.1">Send a WebSocket message</a> comprised of <var>response</var> over <var>connection</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="handle a connection closing">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-a-connection-closing">handle a connection closing</dfn> given a <a data-link-type="dfn" href="#websocket-connection" id="ref-for-websocket-connection⑧">WebSocket connection</a> <var>connection</var>:</p>
    <ol>
     <li data-md>
      <p>If there is a <a data-link-type="dfn" href="#session" id="ref-for-session①④">session</a> <a data-link-type="dfn" href="#session-associated-with-connection" id="ref-for-session-associated-with-connection①">associated with connection</a> <var>connection</var>:</p>
      <ol>
       <li data-md>
        <p>Let <var>session</var> be the <a data-link-type="dfn" href="#session" id="ref-for-session①⑤">session</a> <a data-link-type="dfn" href="#session-associated-with-connection" id="ref-for-session-associated-with-connection②">associated with connection</a> <var>connection</var>.</p>
       <li data-md>
        <p>Remove <var>connection</var> from <var>session</var>’s <a data-link-type="dfn" href="#session-session-websocket-connections" id="ref-for-session-session-websocket-connections①">session WebSocket connections</a>.</p>
      </ol>
     <li data-md>
      <p>Otherwise, if the set of <a data-link-type="dfn" href="#remote-end-websocket-connections-not-associated-with-a-session" id="ref-for-remote-end-websocket-connections-not-associated-with-a-session③">WebSocket connections not associated with a session</a> contains <var>connection</var>, remove <var>connection</var> from that set.</p>
    </ol>
    <p class="issue" id="issue-0e6df82e"><a class="self-link" href="#issue-0e6df82e"></a> As in WebDriver BiDi, this does not end any session. Not sure if we want to allow reconnecting to the same session, or implicitly end the session.</p>
   </div>
   <h3 class="heading settled" data-level="6.1" id="transport-establishing"><span class="secno">6.1. </span><span class="content">Establishing a Connection</span><a class="self-link" href="#transport-establishing"></a></h3>
   <p>The URL to the WebSocket server is communicated out-of-band. When an implementation is ready to accept requests to start an AT Driver session, it must:</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="#start-listening-for-a-websocket-connection" id="ref-for-start-listening-for-a-websocket-connection">Start listening for a WebSocket connection</a>.</p>
   </ol>
   <h2 class="heading settled" data-level="7" id="modules"><span class="secno">7. </span><span class="content">Modules</span><a class="self-link" href="#modules"></a></h2>
   <h3 class="heading settled" data-level="7.1" id="module-session"><span class="secno">7.1. </span><span class="content">The session Module</span><a class="self-link" href="#module-session"></a></h3>
   <h4 class="heading settled" data-level="7.1.1" id="module-session-definition"><span class="secno">7.1.1. </span><span class="content">Definition</span><a class="self-link" href="#module-session-definition"></a></h4>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑤">Remote end definition</a>:</p>
<pre class="cddl remote-cddl">SessionCommand = (SessionNewCommand)
</pre>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑥">Local end definition</a></p>
<pre class="cddl local-cddl">SessionResult = (SessionNewResult)
</pre>
   <h4 class="heading settled" data-level="7.1.2" id="module-session-types"><span class="secno">7.1.2. </span><span class="content">Types</span><a class="self-link" href="#module-session-types"></a></h4>
   <h5 class="heading settled" data-level="7.1.2.1" id="module-session-CapabilitiesRequest"><span class="secno">7.1.2.1. </span><span class="content">The session.CapabilitiesRequest Type</span><a class="self-link" href="#module-session-CapabilitiesRequest"></a></h5>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑥">Remote end definition</a> and <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑦">local end definition</a>:</p>
<pre class="cddl remote-cddl local-cddl">CapabilitiesRequest = {
  ?atName: text,
  ?atVersion: text,
  ?platformName: text,
  *text => any
}
</pre>
   <p>The <code>CapabilitiesRequest</code> type represents capabilities requested for a session.</p>
   <h4 class="heading settled" data-level="7.1.3" id="module-session-commands"><span class="secno">7.1.3. </span><span class="content">Commands</span><a class="self-link" href="#module-session-commands"></a></h4>
   <h5 class="heading settled" data-level="7.1.3.1" id="module-session-new"><span class="secno">7.1.3.1. </span><span class="content">The session.new Command</span><a class="self-link" href="#module-session-new"></a></h5>
   <p>The <dfn data-dfn-type="dfn" data-noexport id="sessionnew">session.new<a class="self-link" href="#sessionnew"></a></dfn> command allows creating a new <a data-link-type="dfn" href="#session" id="ref-for-session①⑥">session</a>. This is a <a data-link-type="dfn" href="#static-command" id="ref-for-static-command①">static command</a>.</p>
   <dl>
    <dt>Command Type 
    <dd>
<pre class="cddl remote-cddl">SessionNewCommand = {
  method: "session.new",
  params: {capabilities: CapabilitiesRequestParameters},
}

CapabilitiesRequestParameters = {
  ?alwaysMatch: CapabilitiesRequest,
}
</pre>
     <p class="note" role="note"><span>Note:</span> <code>firstMatch</code> is not included currently to reduce complexity.</p>
    <dt><a data-link-type="dfn" href="#result-type" id="ref-for-result-type②">Result Type</a> 
    <dd>
<pre class="cddl local-cddl">SessionNewResult = {
  sessionId: text,
  capabilities: {
    atName: text,
    atVersion: text,
    platformName: text,
    *text => any
  }
}
</pre>
   </dl>
   <div class="algorithm" data-algorithm="remote end steps for session.new">
    <p>The <a data-link-type="dfn" href="#remote-end-steps" id="ref-for-remote-end-steps①">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:</p>
    <ol>
     <li data-md>
      <p>If <var>session</var> is not null, return an <a data-link-type="dfn" href="#error" id="ref-for-error⑤">error</a> with error code <a data-link-type="dfn" href="#error-code-session-not-created" id="ref-for-error-code-session-not-created">session not created</a>.</p>
     <li data-md>
      <p>If the list of <a data-link-type="dfn" href="#remote-end-active-sessions" id="ref-for-remote-end-active-sessions②">active sessions</a> is not empty, then return <a data-link-type="dfn" href="#error" id="ref-for-error⑥">error</a> with error code <a data-link-type="dfn" href="#error-code-session-not-created" id="ref-for-error-code-session-not-created①">session not created</a>.</p>
     <li data-md>
      <p>If the implementation is unable to start a new session for any reason, return an <a data-link-type="dfn" href="#error" id="ref-for-error⑦">error</a> with error code <a data-link-type="dfn" href="#error-code-session-not-created" id="ref-for-error-code-session-not-created②">session not created</a>.</p>
     <li data-md>
      <p>Let <var>capabilities</var> be the result of <a data-link-type="dfn" href="#try" id="ref-for-try②">trying</a> to <a data-link-type="dfn" href="#process-capabilities" id="ref-for-process-capabilities">process capabilities</a> with <var>command parameters</var>.</p>
     <li data-md>
      <p>If <var>capabilities</var> is null, return <a data-link-type="dfn" href="#error" id="ref-for-error⑧">error</a> with error code <a data-link-type="dfn" href="#error-code-session-not-created" id="ref-for-error-code-session-not-created③">session not created</a>.</p>
     <li data-md>
      <p>Let <var>session id</var> be the result of <a data-link-type="dfn" href="#generating-a-uuid" id="ref-for-generating-a-uuid">generating a UUID</a>.</p>
     <li data-md>
      <p>Let <var>session</var> be a new <a data-link-type="dfn" href="#session" id="ref-for-session①⑦">session</a> with the <a data-link-type="dfn" href="#session-session-id" id="ref-for-session-session-id①">session ID</a> of <var>session id</var>.</p>
     <li data-md>
      <p>Append <var>session</var> to <a data-link-type="dfn" href="#remote-end-active-sessions" id="ref-for-remote-end-active-sessions③">active sessions</a>.</p>
     <li data-md>
      <p>Start an instance of the appropriate assistive technology, given <var>capabilities</var>.</p>
     <li data-md>
      <p>Let <var>body</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map④">map</a> matching the <code>SessionNewResult</code> production, with the <code>sessionId</code> field set to <var>session</var>’s <a data-link-type="dfn" href="#session-session-id" id="ref-for-session-session-id②">session ID</a>, and the <code>capabilities</code> field set to <var>capabilities</var>.</p>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="#success" id="ref-for-success⑨">success</a> with data <var>body</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="7.2" id="module-vendor-settings"><span class="secno">7.2. </span><span class="content">The &lt;vendor>:settings Module</span><a class="self-link" href="#module-vendor-settings"></a></h3>
   <p>Currently, there are no standardized settings. Implementations that wish to allow controlling and reading settings through the protocol defined in this specification must support settings as an <a data-link-type="dfn" href="#extension-modules" id="ref-for-extension-modules①">extension module</a>, with the structure defined in this section. Implementations are strongly encouraged to review the security implications of each setting, and only support the settings that are deemed safe. It is not defined what constitutes a setting, however, it is intended to represent user preferences such as the default voice, or the default rate of speech.</p>
   <p>In the schema definitions in this section, <code>&lt;vendor></code> is a placeholder for an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑥">implementation-defined</a> prefix for the <a data-link-type="dfn" href="#extension-modules" id="ref-for-extension-modules②">extension module</a>. The value of the prefix should be the name of the vendor or the assistive technology product, as appropriate.</p>
   <p class="note" role="note"><span>Note:</span> The prefix could be, for example, <code>nvda</code>, <code>jaws</code>, or <code>macOSVoiceOver</code>.</p>
   <h4 class="heading settled" data-level="7.2.1" id="module-vendor-settings-definition"><span class="secno">7.2.1. </span><span class="content">Definition</span><a class="self-link" href="#module-vendor-settings-definition"></a></h4>
   <p><a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑦">Remote end definition</a></p>
<pre class="cddl remote-cddl">VendorSettingsCommand = {
  VendorSettingsSetSettingsCommand //
  VendorSettingsGetSettingsCommand //
  VendorSettingsGetSupportedSettingsCommand
}
</pre>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑧">Local end definition</a></p>
<pre class="cddl local-cddl">VendorSettingsResult = {
  VendorSettingsGetSettingsResult
}
</pre>
   <h4 class="heading settled" data-level="7.2.2" id="module-vendor-settings-types"><span class="secno">7.2.2. </span><span class="content">Types</span><a class="self-link" href="#module-vendor-settings-types"></a></h4>
   <h5 class="heading settled" data-level="7.2.2.1" id="module-vendor-settings-get-settings-result"><span class="secno">7.2.2.1. </span><span class="content">The VendorSettingsGetSettingsResult type</span><a class="self-link" href="#module-vendor-settings-get-settings-result"></a></h5>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition⑨">Local end definition</a>:</p>
<pre class="cddl local-cddl">VendorSettingsGetSettingsResult = {
  settings: [1* VendorSettingsGetSettingsResultItem ],
}

VendorSettingsGetSettingsResultItem = {
  name: text,
  value: any,
  *text => any
}
</pre>
   <p>The <code>VendorSettingsGetSettingsResult</code> type contains a list of settings and their values.</p>
   <h4 class="heading settled" data-level="7.2.3" id="module-settings-commands"><span class="secno">7.2.3. </span><span class="content">Commands</span><a class="self-link" href="#module-settings-commands"></a></h4>
   <h5 class="heading settled" data-level="7.2.3.1" id="command-vendor-settings-set-settings"><span class="secno">7.2.3.1. </span><span class="content">The &lt;vendor>:settings.setSettings Command</span><a class="self-link" href="#command-vendor-settings-set-settings"></a></h5>
   <p>This command sets the values of one or more settings.</p>
   <dl>
    <dt>Command Type
    <dd>
<pre class="cddl remote-cddl">VendorSettingsSetSettingsCommand = {
  method: "&lt;vendor>:settings.setSettings",
  params: VendorSettingsSetSettingsParameters
}

VendorSettingSetSettingsParameters = {
  settings: [1* VendorSettingSetSettingsParametersItem ],
}

VendorSettingSetSettingsParametersItem = {
  name: text,
  value: any,
  *text => any
}
</pre>
    <dt><a data-link-type="dfn" href="#result-type" id="ref-for-result-type③">Result Type</a>
    <dd>
<pre class="cddl">EmptyResult
</pre>
   </dl>
   <p>The <a data-link-type="dfn" href="#remote-end-steps" id="ref-for-remote-end-steps②">remote end steps</a> given <var>session</var> and <var>command parameters</var> are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑦">implementation-defined</a>.</p>
   <h5 class="heading settled" data-level="7.2.3.2" id="command-vendor-settings-get-settings"><span class="secno">7.2.3.2. </span><span class="content">The &lt;vendor>settings.getSettings Command</span><a class="self-link" href="#command-vendor-settings-get-settings"></a></h5>
   <p>This command returns a list of the requested settings and their values.</p>
   <dl>
    <dt>Command Type
    <dd>
<pre class="cddl remote-cddl">VendorSettingsGetSettingsCommand = {
  method: "&lt;vendor>:settings.getSettings",
  params: VendorSettingsGetSettingsParameters
}

VendorSettingsGetSettingsParameters = {
  settings: [1* VendorSettingsGetSettingsParametersItem ],
}

VendorSettingsGetSettingsParametersItem = {
  name: text,
  *text => any
}
</pre>
    <dt><a data-link-type="dfn" href="#result-type" id="ref-for-result-type④">Result Type</a>
    <dd>
<pre class="cddl">VendorSettingsGetSettingsResult
</pre>
   </dl>
   <p>The <a data-link-type="dfn" href="#remote-end-steps" id="ref-for-remote-end-steps③">remote end steps</a> given <var>session</var> and <var>command parameters</var> are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑧">implementation-defined</a>.</p>
   <h5 class="heading settled" data-level="7.2.3.3" id="command-vendor-settings-get-supported-settings"><span class="secno">7.2.3.3. </span><span class="content">The &lt;vendor>settings.getSupportedSettings Command</span><a class="self-link" href="#command-vendor-settings-get-supported-settings"></a></h5>
   <p>This command returns a list of all settings that the <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end②①">remote end</a> supports, and their values.</p>
   <dl>
    <dt>Command Type
    <dd>
<pre class="cddl remote-cddl">VendorSettingsGetSupportedSettingsCommand = {
  method: "&lt;vendor>:settings.getSupportedSettings",
  params: EmptyParams
}
</pre>
    <dt><a data-link-type="dfn" href="#result-type" id="ref-for-result-type⑤">Result Type</a>
    <dd>
<pre class="cddl">VendorSettingsGetSettingsResult
</pre>
   </dl>
   <p>The <a data-link-type="dfn" href="#remote-end-steps" id="ref-for-remote-end-steps④">remote end steps</a> given <var>session</var> and <var>command parameters</var> are <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined⑨">implementation-defined</a>.</p>
   <h5 class="heading settled" data-level="7.2.3.4" id="module-vendor-settings-events"><span class="secno">7.2.3.4. </span><span class="content">Events</span><a class="self-link" href="#module-vendor-settings-events"></a></h5>
   <p class="issue" id="issue-0b79b3d5"><a class="self-link" href="#issue-0b79b3d5"></a> Do we need a "setting changed" event?</p>
   <h3 class="heading settled" data-level="7.3" id="module-interaction"><span class="secno">7.3. </span><span class="content">The Interaction Module</span><a class="self-link" href="#module-interaction"></a></h3>
   <h4 class="heading settled" data-level="7.3.1" id="module-interaction-definition"><span class="secno">7.3.1. </span><span class="content">Definition</span><a class="self-link" href="#module-interaction-definition"></a></h4>
   <p><a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①⓪">Local end definition</a>:</p>
<pre class="cddl local-cddl">
InteractionEvent = (InteractionCapturedOutputEvent)

</pre>
   <h4 class="heading settled" data-level="7.3.2" id="module-interaction-types"><span class="secno">7.3.2. </span><span class="content">Types</span><a class="self-link" href="#module-interaction-types"></a></h4>
<pre class="cddl local-cddl">InteractionCapturedOutputParameters = {
  data: text,
  *text => any
}
</pre>
   <h4 class="heading settled" data-level="7.3.3" id="module-interaction-commands"><span class="secno">7.3.3. </span><span class="content">Commands</span><a class="self-link" href="#module-interaction-commands"></a></h4>
   <h5 class="heading settled" data-level="7.3.3.1" id="module-interaction-presskeys"><span class="secno">7.3.3.1. </span><span class="content">The interaction.pressKeys Command</span><a class="self-link" href="#module-interaction-presskeys"></a></h5>
   <p>The <dfn data-dfn-type="dfn" data-noexport id="interactionpresskeys">interaction.pressKeys<a class="self-link" href="#interactionpresskeys"></a></dfn> command simulates pressing a key combination on a keyboard.</p>
   <p class="issue" id="issue-05fb1c8b"><a class="self-link" href="#issue-05fb1c8b"></a> This command does not yet have a means for indicating a screen-reader specific modifier key (or keys). <a href="https://github.com/w3c/aria-at-automation/issues/34">[Issue #34]</a></p>
   <dl>
    <dt>Command Type 
    <dd>
<pre class="cddl remote-cddl">InteractionPressKeysCommand = {
  method: "interaction.pressKeys",
  params: InteractionPressKeysParameters
}

InteractionPressKeysParameters = {
  "keys" => KeyCombination,
  *text => any
}

KeyCombination = [
  1* text
]
</pre>
    <dt>Result Type 
    <dd>
<pre class="cddl">EmptyResult
</pre>
   </dl>
   <p>The <a data-link-type="dfn" href="#remote-end-steps" id="ref-for-remote-end-steps⑤">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:</p>
   <ol>
    <li data-md>
     <p><a data-link-type="dfn" href="#try" id="ref-for-try③">Try</a> to run an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①⓪">implementation-defined</a> security check, e.g. honor OS settings for whether it allows keyboard simulation.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="#try" id="ref-for-try④">Try</a> to <a data-link-type="dfn" href="#check-that-one-of-the-expected-applications-has-focus" id="ref-for-check-that-one-of-the-expected-applications-has-focus">check that one of the expected applications has focus</a>.</p>
    <li data-md>
     <p>Run <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①①">implementation-defined</a> steps to simulate pressing the key combination represented in <code>KeyCombination</code>, such that they first item in the array is pressed first, and then each other key is pressed, in order, and finally the keys are released in reverse order. Each string in <code>KeyCombination</code> represents a "raw key" consisting of a single code point with the same meaning as in <a href="https://w3c.github.io/webdriver/#keyboard-actions">WebDriver’s keyboard actions</a>. For example, <code>["\uE008", "a"]</code> means holding the left shift key and pressing "a", and then releasing the left shift key. <a data-link-type="biblio" href="#biblio-webdriver" title="WebDriver">[WEBDRIVER]</a></p>
   </ol>
   <h4 class="heading settled" data-level="7.3.4" id="module-interaction-events"><span class="secno">7.3.4. </span><span class="content">Events</span><a class="self-link" href="#module-interaction-events"></a></h4>
   <dl>
    <dt>Event Type 
    <dd>
<pre class="cddl local-cddl">InteractionCapturedOutputEvent = {
  method: "interaction.capturedOutput",
  params: InteractionCapuredOutputParameters
}
</pre>
   </dl>
   <div class="algorithm" data-algorithm="remote end event trigger for interaction.capturedOutput">
    <p>The <a data-link-type="dfn" href="#remote-end-event-trigger" id="ref-for-remote-end-event-trigger">remote end event trigger</a> is:</p>
    <p>When the assistive technology would send some text <var>data</var> (a string, without speech-specific markup or annotations) to the Text-To-Speech system, or equivalent for non-speech assistive technology software, run these steps:</p>
    <ol>
     <li data-md>
      <p>Optionally, return. This step allows for an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined①②">implementation-defined</a> security check, to sandbox what information to expose.</p>
     <li data-md>
      <p>Let <var>params</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map⑤">map</a> matching the <code>InteractionCapturedOutputParameters</code> production with the <code>data</code> field set to <var>data</var>.</p>
     <li data-md>
      <p>Let <var>body</var> be a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map⑥">map</a> matching the <code>InteractionCapturedOutputEvent</code> production with the <code>params</code> field set to <var>params</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>session</var> of <a data-link-type="dfn" href="#remote-end-active-sessions" id="ref-for-remote-end-active-sessions④">active sessions</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#emit-an-event" id="ref-for-emit-an-event">Emit an event</a> with <var>session</var> and <var>body</var>.</p>
      </ol>
    </ol>
   </div>
   <h2 class="heading settled" data-level="8" id="privacy"><span class="secno">8. </span><span class="content">Privacy</span><a class="self-link" href="#privacy"></a></h2>
   <p>It is advisable that <a data-link-type="dfn" href="#remote-end" id="ref-for-remote-end②②">remote ends</a> create a new profile when creating a new session. This prevents potentially sensitive session data from being accessible to new sessions, ensuring both privacy and preventing state from bleeding through to the next session.</p>
   <h2 class="heading settled" data-level="9" id="security"><span class="secno">9. </span><span class="content">Security</span><a class="self-link" href="#security"></a></h2>
   <p>An assistive technology can rely on a command-line flag or a configuration option to test whether to enable AT Driver, or alternatively make the assistive technology initiate or confirm the connection through a privileged content document or control widget, in case the assistive technology does not directly implement the WebSocket endpoints.</p>
   <p>It is strongly suggested that assistive technology require users to take explicit action to enable AT Driver, and that AT Driver remains disabled in publicly consumed versions of the assistive technology.</p>
   <p>To prevent arbitrary machines on the network from connecting and creating sessions, it is suggested that only connections from loopback devices are allowed by default.</p>
   <p>The remote end can include a configuration option to limit the accepted IP range allowed to connect and make requests. The default setting for this might be to limit connections to the IPv4 localhost CIDR range 127.0.0.0/8 and the IPv6 localhost address ::1. <a data-link-type="biblio" href="#biblio-rfc4632" title="Classless Inter-domain Routing (CIDR): The Internet Address Assignment and Aggregation Plan">[RFC4632]</a></p>
   <p>It is also suggested that assistive technologies make an effort to indicate that a session that is under control of AT Driver. The indication should be accessible also for non-visual users. For example, this can be done through an OS-level notification or alert dialog.</p>
   <p class="issue" id="issue-f9e956aa"><a class="self-link" href="#issue-f9e956aa"></a> TODO sandbox (limit availability to information that apps usually can’t access, e.g. login screen).</p>
   <p class="issue" id="issue-0225dc78"><a class="self-link" href="#issue-0225dc78"></a> TODO no HID level simulated keypresses.</p>
   <p class="issue" id="issue-fbd6fc51"><a class="self-link" href="#issue-fbd6fc51"></a> TODO exclude access to any security-sensitive settings.</p>
   <p class="issue" id="issue-398c181d"><a class="self-link" href="#issue-398c181d"></a> TODO exclude access to any security-sensitive commands.</p>
   <h2 class="heading settled" id="schemas"><span class="content">Appendix A: Schemas</span><a class="self-link" href="#schemas"></a></h2>
   <p>The <a data-link-type="dfn" href="#remote-end-definition" id="ref-for-remote-end-definition⑧">remote end definition</a> and <a data-link-type="dfn" href="#local-end-definition" id="ref-for-local-end-definition①①">local end definition</a> are available as non-normative CDDL and JSON Schema schemas:</p>
   <ul>
    <li data-md>
     <p><a href="schemas/at-driver-remote.cddl">at-driver-remote.cddl</a></p>
    <li data-md>
     <p><a href="schemas/at-driver-local.cddl">at-driver-local.cddl</a></p>
    <li data-md>
     <p><a href="schemas/at-driver-remote.json">at-driver-remote.json</a></p>
    <li data-md>
     <p><a href="schemas/at-driver-local.json">at-driver-local.json</a></p>
   </ul>
   <p class="issue" id="issue-f906273a"><a class="self-link" href="#issue-f906273a"></a> The JSON Schema files are not yet generated from the CDDL and so might be out of date. <a href="https://github.com/w3c/aria-at-automation/issues/23">[Issue #23]</a></p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#remote-end-active-listeners">active listeners</a><span>, in § 6</span>
   <li><a href="#remote-end-active-sessions">active sessions</a><span>, in § 5.3</span>
   <li><a href="#session-associated-with-connection">associated with connection</a><span>, in § 6</span>
   <li><a href="#standard-capabilities-at-name">AT name</a><span>, in § 5.2</span>
   <li><a href="#standard-capabilities-at-version">AT version</a><span>, in § 5.2</span>
   <li><a href="#capabilities">Capabilities</a><span>, in § 5.2</span>
   <li><a href="#check-that-one-of-the-expected-applications-has-focus">check that one of the expected applications has focus</a><span>, in § 5.8</span>
   <li><a href="#command">command</a><span>, in § 5.5</span>
   <li><a href="#command-name">command name</a><span>, in § 5.5</span>
   <li><a href="#command-parameters">command parameters</a><span>, in § 5.5</span>
   <li><a href="#command-type">command type</a><span>, in § 5.5</span>
   <li><a href="#emit-an-event">emit an event</a><span>, in § 6</span>
   <li><a href="#error">error</a><span>, in § 3</span>
   <li><a href="#error-code">error code</a><span>, in § 5.7</span>
   <li><a href="#event">event</a><span>, in § 5.6</span>
   <li><a href="#event-name">event name</a><span>, in § 5.6</span>
   <li><a href="#event-parameters">event parameters</a><span>, in § 5.6</span>
   <li><a href="#event-type">event type</a><span>, in § 5.6</span>
   <li><a href="#extension-capabilities">extension capabilities</a><span>, in § 5.2</span>
   <li><a href="#extension-modules">extension modules</a><span>, in § 5.4</span>
   <li><a href="#generating-a-uuid">Generating a UUID</a><span>, in § 3</span>
   <li><a href="#handle-a-connection-closing">handle a connection closing</a><span>, in § 6</span>
   <li><a href="#handle-an-incoming-message">handle an incoming message</a><span>, in § 6</span>
   <li><a href="#websocket-listener-host">host</a><span>, in § 6</span>
   <li><a href="#interactionpresskeys">interaction.pressKeys</a><span>, in § 7.3.3.1</span>
   <li><a href="#error-code-invalid-argument">invalid argument</a><span>, in § 5.7</span>
   <li><a href="#error-code-invalid-os-focus-state">invalid OS focus state</a><span>, in § 5.7</span>
   <li><a href="#error-code-invalid-session-id">invalid session id</a><span>, in § 5.7</span>
   <li><a href="#local-end">local end</a><span>, in § 4</span>
   <li><a href="#local-end-definition">local end definition</a><span>, in § 5</span>
   <li><a href="#match-capabilities">match capabilities</a><span>, in § 5.2</span>
   <li><a href="#module">module</a><span>, in § 5.4</span>
   <li><a href="#module-name">module name</a><span>, in § 5.4</span>
   <li><a href="#standard-capabilities-platform">Platform</a><span>, in § 5.2</span>
   <li><a href="#websocket-listener-port">port</a><span>, in § 6</span>
   <li><a href="#process-capabilities">process capabilities</a><span>, in § 5.2</span>
   <li><a href="#remote-end">remote end</a><span>, in § 4</span>
   <li><a href="#remote-end-definition">remote end definition</a><span>, in § 5</span>
   <li><a href="#remote-end-event-trigger">remote end event trigger</a><span>, in § 5.6</span>
   <li><a href="#remote-end-steps">remote end steps</a><span>, in § 5.5</span>
   <li><a href="#respond-with-an-error">respond with an error</a><span>, in § 6</span>
   <li><a href="#result-type">result type</a><span>, in § 5.5</span>
   <li><a href="#websocket-listener-secure-flag">secure flag</a><span>, in § 6</span>
   <li><a href="#session">session</a><span>, in § 5.3</span>
   <li><a href="#session-session-id">session ID</a><span>, in § 5.3</span>
   <li><a href="#sessionnew">session.new</a><span>, in § 7.1.3.1</span>
   <li><a href="#error-code-session-not-created">session not created</a><span>, in § 5.7</span>
   <li><a href="#session-session-websocket-connections">session WebSocket connections</a><span>, in § 6</span>
   <li><a href="#set-of-all-command-names">set of all command names</a><span>, in § 5.5</span>
   <li><a href="#standard-capabilities">standard capabilities</a><span>, in § 5.2</span>
   <li><a href="#start-listening-for-a-websocket-connection">start listening for a WebSocket connection</a><span>, in § 6</span>
   <li><a href="#static-command">static command</a><span>, in § 5.5</span>
   <li><a href="#success">success</a><span>, in § 3</span>
   <li><a href="#try">try</a><span>, in § 3</span>
   <li><a href="#try">trying</a><span>, in § 3</span>
   <li><a href="#error-code-unknown-command">unknown command</a><span>, in § 5.7</span>
   <li><a href="#uuid">UUID</a><span>, in § 3</span>
   <li><a href="#websocket-connection">WebSocket connection</a><span>, in § 6</span>
   <li><a href="#remote-end-websocket-connections-not-associated-with-a-session">WebSocket connections not associated with a session</a><span>, in § 6</span>
   <li><a href="#websocket-listener">WebSocket listener</a><span>, in § 6</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-set-append">
   <a href="https://infra.spec.whatwg.org/#set-append">https://infra.spec.whatwg.org/#set-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-append">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-lowercase">
   <a href="https://infra.spec.whatwg.org/#ascii-lowercase">https://infra.spec.whatwg.org/#ascii-lowercase</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-lowercase">5.2. Capabilities</a> <a href="#ref-for-ascii-lowercase①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-assert">
   <a href="https://infra.spec.whatwg.org/#assert">https://infra.spec.whatwg.org/#assert</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-assert">6. Transport</a> <a href="#ref-for-assert①">(2)</a> <a href="#ref-for-assert②">(3)</a> <a href="#ref-for-assert③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">5.2. Capabilities</a> <a href="#ref-for-map-exists①">(2)</a>
    <li><a href="#ref-for-map-exists②">6. Transport</a> <a href="#ref-for-map-exists③">(2)</a> <a href="#ref-for-map-exists④">(3)</a> <a href="#ref-for-map-exists⑤">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org/#map-exists">https://infra.spec.whatwg.org/#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">5.2. Capabilities</a> <a href="#ref-for-map-exists①">(2)</a>
    <li><a href="#ref-for-map-exists②">6. Transport</a> <a href="#ref-for-map-exists③">(2)</a> <a href="#ref-for-map-exists④">(3)</a> <a href="#ref-for-map-exists⑤">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-iterate">
   <a href="https://infra.spec.whatwg.org/#list-iterate">https://infra.spec.whatwg.org/#list-iterate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-iterate">7.3.4. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-iterate">
   <a href="https://infra.spec.whatwg.org/#map-iterate">https://infra.spec.whatwg.org/#map-iterate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-iterate">5.2. Capabilities</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-implementation-defined">
   <a href="https://infra.spec.whatwg.org/#implementation-defined">https://infra.spec.whatwg.org/#implementation-defined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-implementation-defined">5.2. Capabilities</a>
    <li><a href="#ref-for-implementation-defined①">5.8. Security checks</a>
    <li><a href="#ref-for-implementation-defined②">6. Transport</a> <a href="#ref-for-implementation-defined③">(2)</a> <a href="#ref-for-implementation-defined④">(3)</a> <a href="#ref-for-implementation-defined⑤">(4)</a>
    <li><a href="#ref-for-implementation-defined⑥">7.2. The &lt;vendor>:settings Module</a>
    <li><a href="#ref-for-implementation-defined⑦">7.2.3.1. The &lt;vendor>:settings.setSettings Command</a>
    <li><a href="#ref-for-implementation-defined⑧">7.2.3.2. The &lt;vendor>settings.getSettings Command</a>
    <li><a href="#ref-for-implementation-defined⑨">7.2.3.3. The &lt;vendor>settings.getSupportedSettings Command</a>
    <li><a href="#ref-for-implementation-defined①⓪">7.3.3.1. The interaction.pressKeys Command</a> <a href="#ref-for-implementation-defined①①">(2)</a>
    <li><a href="#ref-for-implementation-defined①②">7.3.4. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-map">
   <a href="https://infra.spec.whatwg.org/#ordered-map">https://infra.spec.whatwg.org/#ordered-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-map">5.2. Capabilities</a>
    <li><a href="#ref-for-ordered-map①">6. Transport</a> <a href="#ref-for-ordered-map②">(2)</a> <a href="#ref-for-ordered-map③">(3)</a>
    <li><a href="#ref-for-ordered-map④">7.1.3.1. The session.new Command</a>
    <li><a href="#ref-for-ordered-map⑤">7.3.4. Events</a> <a href="#ref-for-ordered-map⑥">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parse-a-json-string-to-an-infra-value">
   <a href="https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value">https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parse-a-json-string-to-an-infra-value">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-scalar-value-string">
   <a href="https://infra.spec.whatwg.org/#scalar-value-string">https://infra.spec.whatwg.org/#scalar-value-string</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-scalar-value-string">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-serialize-an-infra-value-to-json-bytes">
   <a href="https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes">https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-serialize-an-infra-value-to-json-bytes">6. Transport</a> <a href="#ref-for-serialize-an-infra-value-to-json-bytes①">(2)</a> <a href="#ref-for-serialize-an-infra-value-to-json-bytes②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-set">
   <a href="https://infra.spec.whatwg.org/#ordered-set">https://infra.spec.whatwg.org/#ordered-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-set">5.5. Commands</a>
    <li><a href="#ref-for-ordered-set①">6. Transport</a> <a href="#ref-for-ordered-set②">(2)</a> <a href="#ref-for-ordered-set③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-set">
   <a href="https://infra.spec.whatwg.org/#map-set">https://infra.spec.whatwg.org/#map-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-set">5.2. Capabilities</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-size">
   <a href="https://infra.spec.whatwg.org/#map-size">https://infra.spec.whatwg.org/#map-size</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-size">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-string">
   <a href="https://infra.spec.whatwg.org/#string">https://infra.spec.whatwg.org/#string</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-string">5.2. Capabilities</a> <a href="#ref-for-string①">(2)</a> <a href="#ref-for-string②">(3)</a> <a href="#ref-for-string③">(4)</a> <a href="#ref-for-string④">(5)</a> <a href="#ref-for-string⑤">(6)</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-set-append">append</span>
     <li><span class="dfn-paneled" id="term-for-ascii-lowercase">ascii lowercase</span>
     <li><span class="dfn-paneled" id="term-for-assert">assert</span>
     <li><span class="dfn-paneled" id="term-for-map-exists">contain</span>
     <li><span class="dfn-paneled" id="term-for-map-exists①">exist</span>
     <li><span class="dfn-paneled" id="term-for-list-iterate">for each <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="term-for-map-iterate">for each <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="term-for-implementation-defined">implementation-defined</span>
     <li><span class="dfn-paneled" id="term-for-ordered-map">map</span>
     <li><span class="dfn-paneled" id="term-for-parse-a-json-string-to-an-infra-value">parse json into infra values</span>
     <li><span class="dfn-paneled" id="term-for-scalar-value-string">scalar value string</span>
     <li><span class="dfn-paneled" id="term-for-serialize-an-infra-value-to-json-bytes">serialize an infra value to json bytes</span>
     <li><span class="dfn-paneled" id="term-for-ordered-set">set</span>
     <li><span class="dfn-paneled" id="term-for-map-set">set <small>(for map)</small></span>
     <li><span class="dfn-paneled" id="term-for-map-size">size</span>
     <li><span class="dfn-paneled" id="term-for-string">string</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc4122">[RFC4122]
   <dd>P. Leach; M. Mealling; R. Salz. <a href="https://www.rfc-editor.org/rfc/rfc4122"><cite>A Universally Unique IDentifier (UUID) URN Namespace</cite></a>. July 2005. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc4122">https://www.rfc-editor.org/rfc/rfc4122</a>
   <dt id="biblio-rfc6455">[RFC6455]
   <dd>I. Fette; A. Melnikov. <a href="https://www.rfc-editor.org/rfc/rfc6455"><cite>The WebSocket Protocol</cite></a>. December 2011. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6455">https://www.rfc-editor.org/rfc/rfc6455</a>
   <dt id="biblio-rfc8610">[RFC8610]
   <dd>H. Birkholz; C. Vigano; C. Bormann. <a href="https://www.rfc-editor.org/rfc/rfc8610"><cite>Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures</cite></a>. June 2019. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-rfc4632">[RFC4632]
   <dd>V. Fuller; T. Li. <a href="https://www.rfc-editor.org/rfc/rfc4632"><cite>Classless Inter-domain Routing (CIDR): The Internet Address Assignment and Aggregation Plan</cite></a>. August 2006. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc4632">https://www.rfc-editor.org/rfc/rfc4632</a>
   <dt id="biblio-webdriver">[WEBDRIVER]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> As in WebDriver BiDi, this does not end any session. Not sure if we want to allow reconnecting to the same session, or implicitly end the session. <a class="issue-return" href="#issue-0e6df82e" title="Jump to section">↵</a></div>
   <div class="issue"> Do we need a "setting changed" event? <a class="issue-return" href="#issue-0b79b3d5" title="Jump to section">↵</a></div>
   <div class="issue"> This command does not yet have a means for indicating a screen-reader specific modifier key (or keys). <a href="https://github.com/w3c/aria-at-automation/issues/34">[Issue #34]</a> <a class="issue-return" href="#issue-05fb1c8b" title="Jump to section">↵</a></div>
   <div class="issue"> TODO sandbox (limit availability to information that apps usually can’t access, e.g. login screen). <a class="issue-return" href="#issue-f9e956aa" title="Jump to section">↵</a></div>
   <div class="issue"> TODO no HID level simulated keypresses. <a class="issue-return" href="#issue-0225dc78" title="Jump to section">↵</a></div>
   <div class="issue"> TODO exclude access to any security-sensitive settings. <a class="issue-return" href="#issue-fbd6fc51" title="Jump to section">↵</a></div>
   <div class="issue"> TODO exclude access to any security-sensitive commands. <a class="issue-return" href="#issue-398c181d" title="Jump to section">↵</a></div>
   <div class="issue"> The JSON Schema files are not yet generated from the CDDL and so might be out of date. <a href="https://github.com/w3c/aria-at-automation/issues/23">[Issue #23]</a> <a class="issue-return" href="#issue-f906273a" title="Jump to section">↵</a></div>
  </div>
  <aside class="dfn-panel" data-for="uuid">
   <b><a href="#uuid">#uuid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-uuid">5.3. Session</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="generating-a-uuid">
   <b><a href="#generating-a-uuid">#generating-a-uuid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-generating-a-uuid">7.1.3.1. The session.new Command</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="success">
   <b><a href="#success">#success</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-success">3. Infrastructure</a>
    <li><a href="#ref-for-success①">5.2. Capabilities</a> <a href="#ref-for-success②">(2)</a> <a href="#ref-for-success③">(3)</a> <a href="#ref-for-success④">(4)</a> <a href="#ref-for-success⑤">(5)</a> <a href="#ref-for-success⑥">(6)</a>
    <li><a href="#ref-for-success⑦">5.5. Commands</a>
    <li><a href="#ref-for-success⑧">5.8. Security checks</a>
    <li><a href="#ref-for-success⑨">7.1.3.1. The session.new Command</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="error">
   <b><a href="#error">#error</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-error">3. Infrastructure</a> <a href="#ref-for-error①">(2)</a>
    <li><a href="#ref-for-error②">5.5. Commands</a>
    <li><a href="#ref-for-error③">5.8. Security checks</a>
    <li><a href="#ref-for-error④">6. Transport</a>
    <li><a href="#ref-for-error⑤">7.1.3.1. The session.new Command</a> <a href="#ref-for-error⑥">(2)</a> <a href="#ref-for-error⑦">(3)</a> <a href="#ref-for-error⑧">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="try">
   <b><a href="#try">#try</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-try">5.2. Capabilities</a> <a href="#ref-for-try①">(2)</a>
    <li><a href="#ref-for-try②">7.1.3.1. The session.new Command</a>
    <li><a href="#ref-for-try③">7.3.3.1. The interaction.pressKeys Command</a> <a href="#ref-for-try④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="local-end">
   <b><a href="#local-end">#local-end</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-local-end">5. Protocol</a> <a href="#ref-for-local-end①">(2)</a>
    <li><a href="#ref-for-local-end②">5.2. Capabilities</a>
    <li><a href="#ref-for-local-end③">5.3. Session</a>
    <li><a href="#ref-for-local-end④">5.5. Commands</a> <a href="#ref-for-local-end⑤">(2)</a> <a href="#ref-for-local-end⑥">(3)</a> <a href="#ref-for-local-end⑦">(4)</a>
    <li><a href="#ref-for-local-end⑧">5.6. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="remote-end">
   <b><a href="#remote-end">#remote-end</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-remote-end">5. Protocol</a> <a href="#ref-for-remote-end①">(2)</a>
    <li><a href="#ref-for-remote-end②">5.2. Capabilities</a> <a href="#ref-for-remote-end③">(2)</a> <a href="#ref-for-remote-end④">(3)</a> <a href="#ref-for-remote-end⑤">(4)</a> <a href="#ref-for-remote-end⑥">(5)</a> <a href="#ref-for-remote-end⑦">(6)</a>
    <li><a href="#ref-for-remote-end⑧">5.3. Session</a> <a href="#ref-for-remote-end⑨">(2)</a>
    <li><a href="#ref-for-remote-end①⓪">5.5. Commands</a> <a href="#ref-for-remote-end①①">(2)</a>
    <li><a href="#ref-for-remote-end①②">5.6. Events</a> <a href="#ref-for-remote-end①③">(2)</a>
    <li><a href="#ref-for-remote-end①④">5.7. Errors</a>
    <li><a href="#ref-for-remote-end①⑤">6. Transport</a> <a href="#ref-for-remote-end①⑥">(2)</a> <a href="#ref-for-remote-end①⑦">(3)</a> <a href="#ref-for-remote-end①⑧">(4)</a> <a href="#ref-for-remote-end①⑨">(5)</a> <a href="#ref-for-remote-end②⓪">(6)</a>
    <li><a href="#ref-for-remote-end②①">7.2.3.3. The &lt;vendor>settings.getSupportedSettings Command</a>
    <li><a href="#ref-for-remote-end②②">8. Privacy</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="remote-end-definition">
   <b><a href="#remote-end-definition">#remote-end-definition</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-remote-end-definition">5.1. Definition</a>
    <li><a href="#ref-for-remote-end-definition①">5.4. Modules</a> <a href="#ref-for-remote-end-definition②">(2)</a>
    <li><a href="#ref-for-remote-end-definition③">5.5. Commands</a>
    <li><a href="#ref-for-remote-end-definition④">6. Transport</a>
    <li><a href="#ref-for-remote-end-definition⑤">7.1.1. Definition</a>
    <li><a href="#ref-for-remote-end-definition⑥">7.1.2.1. The session.CapabilitiesRequest Type</a>
    <li><a href="#ref-for-remote-end-definition⑦">7.2.1. Definition</a>
    <li><a href="#ref-for-remote-end-definition⑧">Appendix A: Schemas</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="local-end-definition">
   <b><a href="#local-end-definition">#local-end-definition</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-local-end-definition">5.1. Definition</a>
    <li><a href="#ref-for-local-end-definition①">5.4. Modules</a>
    <li><a href="#ref-for-local-end-definition②">5.5. Commands</a>
    <li><a href="#ref-for-local-end-definition③">5.6. Events</a>
    <li><a href="#ref-for-local-end-definition④">6. Transport</a> <a href="#ref-for-local-end-definition⑤">(2)</a>
    <li><a href="#ref-for-local-end-definition⑥">7.1.1. Definition</a>
    <li><a href="#ref-for-local-end-definition⑦">7.1.2.1. The session.CapabilitiesRequest Type</a>
    <li><a href="#ref-for-local-end-definition⑧">7.2.1. Definition</a>
    <li><a href="#ref-for-local-end-definition⑨">7.2.2.1. The VendorSettingsGetSettingsResult type</a>
    <li><a href="#ref-for-local-end-definition①⓪">7.3.1. Definition</a>
    <li><a href="#ref-for-local-end-definition①①">Appendix A: Schemas</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="extension-capabilities">
   <b><a href="#extension-capabilities">#extension-capabilities</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extension-capabilities">5.2. Capabilities</a> <a href="#ref-for-extension-capabilities①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="process-capabilities">
   <b><a href="#process-capabilities">#process-capabilities</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-capabilities">7.1.3.1. The session.new Command</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="match-capabilities">
   <b><a href="#match-capabilities">#match-capabilities</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-match-capabilities">5.2. Capabilities</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="session">
   <b><a href="#session">#session</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-session">2. Explainer</a> <a href="#ref-for-session①">(2)</a>
    <li><a href="#ref-for-session②">5.2. Capabilities</a> <a href="#ref-for-session③">(2)</a>
    <li><a href="#ref-for-session④">5.3. Session</a> <a href="#ref-for-session⑤">(2)</a>
    <li><a href="#ref-for-session⑥">5.5. Commands</a>
    <li><a href="#ref-for-session⑦">5.7. Errors</a> <a href="#ref-for-session⑧">(2)</a>
    <li><a href="#ref-for-session⑨">6. Transport</a> <a href="#ref-for-session①⓪">(2)</a> <a href="#ref-for-session①①">(3)</a> <a href="#ref-for-session①②">(4)</a> <a href="#ref-for-session①③">(5)</a> <a href="#ref-for-session①④">(6)</a> <a href="#ref-for-session①⑤">(7)</a>
    <li><a href="#ref-for-session①⑥">7.1.3.1. The session.new Command</a> <a href="#ref-for-session①⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="remote-end-active-sessions">
   <b><a href="#remote-end-active-sessions">#remote-end-active-sessions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-remote-end-active-sessions">5.3. Session</a>
    <li><a href="#ref-for-remote-end-active-sessions①">6. Transport</a>
    <li><a href="#ref-for-remote-end-active-sessions②">7.1.3.1. The session.new Command</a> <a href="#ref-for-remote-end-active-sessions③">(2)</a>
    <li><a href="#ref-for-remote-end-active-sessions④">7.3.4. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="session-session-id">
   <b><a href="#session-session-id">#session-session-id</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-session-session-id">6. Transport</a>
    <li><a href="#ref-for-session-session-id①">7.1.3.1. The session.new Command</a> <a href="#ref-for-session-session-id②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="module-name">
   <b><a href="#module-name">#module-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-module-name">5.4. Modules</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="extension-modules">
   <b><a href="#extension-modules">#extension-modules</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extension-modules">5.5. Commands</a>
    <li><a href="#ref-for-extension-modules①">7.2. The &lt;vendor>:settings Module</a> <a href="#ref-for-extension-modules②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="command">
   <b><a href="#command">#command</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-command">5.4. Modules</a> <a href="#ref-for-command①">(2)</a> <a href="#ref-for-command②">(3)</a>
    <li><a href="#ref-for-command③">5.5. Commands</a>
    <li><a href="#ref-for-command④">5.7. Errors</a> <a href="#ref-for-command⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="command-name">
   <b><a href="#command-name">#command-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-command-name">5.4. Modules</a>
    <li><a href="#ref-for-command-name①">5.5. Commands</a>
    <li><a href="#ref-for-command-name②">6. Transport</a> <a href="#ref-for-command-name③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="command-parameters">
   <b><a href="#command-parameters">#command-parameters</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-command-parameters">5.5. Commands</a>
    <li><a href="#ref-for-command-parameters①">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="result-type">
   <b><a href="#result-type">#result-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-result-type">5.5. Commands</a>
    <li><a href="#ref-for-result-type①">6. Transport</a>
    <li><a href="#ref-for-result-type②">7.1.3.1. The session.new Command</a>
    <li><a href="#ref-for-result-type③">7.2.3.1. The &lt;vendor>:settings.setSettings Command</a>
    <li><a href="#ref-for-result-type④">7.2.3.2. The &lt;vendor>settings.getSettings Command</a>
    <li><a href="#ref-for-result-type⑤">7.2.3.3. The &lt;vendor>settings.getSupportedSettings Command</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="remote-end-steps">
   <b><a href="#remote-end-steps">#remote-end-steps</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-remote-end-steps">6. Transport</a>
    <li><a href="#ref-for-remote-end-steps①">7.1.3.1. The session.new Command</a>
    <li><a href="#ref-for-remote-end-steps②">7.2.3.1. The &lt;vendor>:settings.setSettings Command</a>
    <li><a href="#ref-for-remote-end-steps③">7.2.3.2. The &lt;vendor>settings.getSettings Command</a>
    <li><a href="#ref-for-remote-end-steps④">7.2.3.3. The &lt;vendor>settings.getSupportedSettings Command</a>
    <li><a href="#ref-for-remote-end-steps⑤">7.3.3.1. The interaction.pressKeys Command</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="static-command">
   <b><a href="#static-command">#static-command</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-static-command">6. Transport</a>
    <li><a href="#ref-for-static-command①">7.1.3.1. The session.new Command</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-of-all-command-names">
   <b><a href="#set-of-all-command-names">#set-of-all-command-names</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-of-all-command-names">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="event">
   <b><a href="#event">#event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event">5.4. Modules</a> <a href="#ref-for-event①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="event-type">
   <b><a href="#event-type">#event-type</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-type">5.6. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="event-name">
   <b><a href="#event-name">#event-name</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-name">5.4. Modules</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="remote-end-event-trigger">
   <b><a href="#remote-end-event-trigger">#remote-end-event-trigger</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-remote-end-event-trigger">7.3.4. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="error-code">
   <b><a href="#error-code">#error-code</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-error-code">3. Infrastructure</a>
    <li><a href="#ref-for-error-code①">5.8. Security checks</a>
    <li><a href="#ref-for-error-code②">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="error-code-invalid-session-id">
   <b><a href="#error-code-invalid-session-id">#error-code-invalid-session-id</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-error-code-invalid-session-id">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="error-code-unknown-command">
   <b><a href="#error-code-unknown-command">#error-code-unknown-command</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-error-code-unknown-command">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="error-code-session-not-created">
   <b><a href="#error-code-session-not-created">#error-code-session-not-created</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-error-code-session-not-created">7.1.3.1. The session.new Command</a> <a href="#ref-for-error-code-session-not-created①">(2)</a> <a href="#ref-for-error-code-session-not-created②">(3)</a> <a href="#ref-for-error-code-session-not-created③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="error-code-invalid-os-focus-state">
   <b><a href="#error-code-invalid-os-focus-state">#error-code-invalid-os-focus-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-error-code-invalid-os-focus-state">5.8. Security checks</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="check-that-one-of-the-expected-applications-has-focus">
   <b><a href="#check-that-one-of-the-expected-applications-has-focus">#check-that-one-of-the-expected-applications-has-focus</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-check-that-one-of-the-expected-applications-has-focus">7.3.3.1. The interaction.pressKeys Command</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="websocket-listener">
   <b><a href="#websocket-listener">#websocket-listener</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-websocket-listener">6. Transport</a> <a href="#ref-for-websocket-listener①">(2)</a> <a href="#ref-for-websocket-listener②">(3)</a> <a href="#ref-for-websocket-listener③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="websocket-listener-host">
   <b><a href="#websocket-listener-host">#websocket-listener-host</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-websocket-listener-host">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="websocket-listener-port">
   <b><a href="#websocket-listener-port">#websocket-listener-port</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-websocket-listener-port">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="websocket-listener-secure-flag">
   <b><a href="#websocket-listener-secure-flag">#websocket-listener-secure-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-websocket-listener-secure-flag">6. Transport</a> <a href="#ref-for-websocket-listener-secure-flag①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="remote-end-active-listeners">
   <b><a href="#remote-end-active-listeners">#remote-end-active-listeners</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-remote-end-active-listeners">6. Transport</a> <a href="#ref-for-remote-end-active-listeners①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="remote-end-websocket-connections-not-associated-with-a-session">
   <b><a href="#remote-end-websocket-connections-not-associated-with-a-session">#remote-end-websocket-connections-not-associated-with-a-session</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-remote-end-websocket-connections-not-associated-with-a-session">6. Transport</a> <a href="#ref-for-remote-end-websocket-connections-not-associated-with-a-session①">(2)</a> <a href="#ref-for-remote-end-websocket-connections-not-associated-with-a-session②">(3)</a> <a href="#ref-for-remote-end-websocket-connections-not-associated-with-a-session③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="websocket-connection">
   <b><a href="#websocket-connection">#websocket-connection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-websocket-connection">6. Transport</a> <a href="#ref-for-websocket-connection①">(2)</a> <a href="#ref-for-websocket-connection②">(3)</a> <a href="#ref-for-websocket-connection③">(4)</a> <a href="#ref-for-websocket-connection④">(5)</a> <a href="#ref-for-websocket-connection⑤">(6)</a> <a href="#ref-for-websocket-connection⑥">(7)</a> <a href="#ref-for-websocket-connection⑦">(8)</a> <a href="#ref-for-websocket-connection⑧">(9)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="session-session-websocket-connections">
   <b><a href="#session-session-websocket-connections">#session-session-websocket-connections</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-session-session-websocket-connections">6. Transport</a> <a href="#ref-for-session-session-websocket-connections①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="session-associated-with-connection">
   <b><a href="#session-associated-with-connection">#session-associated-with-connection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-session-associated-with-connection">6. Transport</a> <a href="#ref-for-session-associated-with-connection①">(2)</a> <a href="#ref-for-session-associated-with-connection②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="start-listening-for-a-websocket-connection">
   <b><a href="#start-listening-for-a-websocket-connection">#start-listening-for-a-websocket-connection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-start-listening-for-a-websocket-connection">6.1. Establishing a Connection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-an-incoming-message">
   <b><a href="#handle-an-incoming-message">#handle-an-incoming-message</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-an-incoming-message">6. Transport</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="emit-an-event">
   <b><a href="#emit-an-event">#emit-an-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-emit-an-event">7.3.4. Events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="respond-with-an-error">
   <b><a href="#respond-with-an-error">#respond-with-an-error</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-respond-with-an-error">6. Transport</a> <a href="#ref-for-respond-with-an-error①">(2)</a> <a href="#ref-for-respond-with-an-error②">(3)</a> <a href="#ref-for-respond-with-an-error③">(4)</a> <a href="#ref-for-respond-with-an-error④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-a-connection-closing">
   <b><a href="#handle-a-connection-closing">#handle-a-connection-closing</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-a-connection-closing">6. Transport</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    "use strict";
    {
        document.addEventListener("click", e=>{
            if(e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>